function d = controller(x, z)
    % Cut and paste state variables into the form the linearized model expects.
    % Ditto with the reference input.
    x3d = [ x(4) x(6) x(11) x(8) x(5) x(10) x(12) x(7) x(9) ]';

    Kstate = [ ...
    0.00228579428659108 -0.0166873081541561 0.142696553245183   0.448733407528170   -4.89434360180788e-17   4.14810275173425e-17    2.88686535089178e-16    4.05369054540226e-17    -2.02298055463092e-16; ...
    7.98915436459252e-16    -6.82427137912550e-16   1.70529998389573e-15    1.31303932545330e-14    -0.125417502149324  0.439991169988528   0.170680187083551   7.72939950997889    0.0707644420934317; ...
];

    Kref = [ ...
    0.0447213595499900  -1.62131079808177e-16; ...
    1.08835189774928e-14    1                ; ...
];
    d = (-[Kstate Kref]*[x3d; z])';
end

