function d = controller(x, z)
    % Cut and paste state variables into the form the linearized model expects.
    % Ditto with the reference input.
    x3d = [ x(4) x(6) x(11) x(8) x(5) x(10) x(12) x(7) x(9) ]';

    Kstate = [ ...
    0.0681611823788915  -0.0243585322019932 -0.474906162041310  0.144674045769844   4.58495733960513e-08    3.02999204653735e-07    -1.87897633422421e-07   -2.05539173424338e-07   2.76934038722985e-08; ...
    -3.78531442067423e-10   -4.42639724786777e-10   2.79962038998099e-09    -1.32885873284425e-09   -0.432784744912595  -6.26957076970843   1.87585023489344    0.378127318375540   -0.0509433192636341; ...
];

    Kref = [ ...
    6.86797517241518e-08    1.11617594908171e-13; ...
    2.41005151589724e-14    4.79813151522467e-10; ...
];
    d = (-[Kstate Kref]*[x3d; z])';
end

