function d = controller(x, z)
    % Cut and paste state variables into the form the linearized model expects.
    % Ditto with the reference input.
    x3d = [ x(4) x(6) x(11) x(8) x(5) x(10) x(12) x(7) x(9) ]';

    Kstate = [ ...
    0.00810309552458979 -0.0400603139073245 0.880119980923609   0.830415914303863   -8.30383591879514e-17   6.67648319281354e-17    6.65779132202186e-16    -1.23728454635484e-15   -8.08311418034920e-17; ...
    -1.83777985774039e-15   -1.48317281697540e-15   -3.06675517673273e-15   1.10046051388706e-15    -0.125417502149331  0.439991169988530   0.170680187083617   7.72939950997870    0.0707644420934246; ...
];

    Kref = [ ...
    0.0447213595499945  1.47613512560626e-16; ...
    -1.33796062521931e-14   0.999999999999995; ...
];
    d = (-[Kstate Kref]*[x3d; z])';
end

